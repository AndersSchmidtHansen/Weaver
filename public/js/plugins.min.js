!function(e,t){"function"==typeof define&&define.amd?define([],t):t()}(this,function(){Function.prototype.debc=function(e){return Function.prototype.deb.apply(this,[e,!0])},Function.prototype.deb=function(e,t){var r,n=function(){return"rgb("+(Math.floor(76*Math.random())+200)+","+(Math.floor(76*Math.random())+200)+","+(Math.floor(76*Math.random())+200)+")"},s=function(e,n,s){"undefined"!=typeof console&&(c&&"string"==typeof e?s!==!1&&e.indexOf("%20")<0?console[n?t?"groupCollapsed":"group":"log"]("%c"+e,"background:"+r+";"+s):console[n?t?"groupCollapsed":"group":"log"](e):console[n?"group":"log"](e))},o=function(){"undefined"!=typeof console&&console.groupEnd()},p=function(t,r,n){var p=n.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[0];if(0===t[0].indexOf("Error")&&(t=t.slice(1)),s(e+p+")",u),r&&r.length>0){s("arguments:",!0);for(var i=0;i<r.length;i++){var a="function"==typeof r[i]?"function":r[i];s(a,!1,"color:#727272;font-size:10px;")}o()}if(t&&t.length>1){s("stack trace:",!0);for(var i=0;i<t.length;i++)s("  "+t[i].trim(),!1,!1);o()}},i=function(e,t){s("  returns: "+("function"==typeof t?"function":t)),s("  duration: "+(Date.now()-e)+"ms"),s("}"),u&&o()},a=this,e=e?e+": ":"",u=console&&console.group&&console.groupEnd,c=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;return function(){r=n();var e=Date.now();p((new Error).stack.split(new RegExp("\\n")),arguments,a);var t=a.apply(this,Array.prototype.slice.call(arguments,0));return i(e,t),t}}});var UserApp=window.UserApp||{};window.console||(window.console={},window.console.log||(window.console.log=function(){},window.console.error=function(){})),UserApp.global={baseAddress:null,appId:null,token:null,debug:!1,secure:!1},Base64={},Base64.PADCHAR="=",Base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Base64.getbyte=function(e,t){var r=e.charCodeAt(t);if(r>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return r},Base64.encode=function(e){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var t,r,n=Base64.PADCHAR,s=Base64.ALPHA,o=Base64.getbyte,p=[];e=""+e;var i=e.length-e.length%3;if(0==e.length)return e;for(t=0;i>t;t+=3)r=o(e,t)<<16|o(e,t+1)<<8|o(e,t+2),p.push(s.charAt(r>>18)),p.push(s.charAt(r>>12&63)),p.push(s.charAt(r>>6&63)),p.push(s.charAt(63&r));switch(e.length-i){case 1:r=o(e,t)<<16,p.push(s.charAt(r>>18)+s.charAt(r>>12&63)+n+n);break;case 2:r=o(e,t)<<16|o(e,t+1)<<8,p.push(s.charAt(r>>18)+s.charAt(r>>12&63)+s.charAt(r>>6&63)+n)}return p.join("")};var parseResponseHeaders=function(e){var t={};if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;++n){var s=r[n],o=s.indexOf(": ");if(o>0){var p=s.substring(0,o),i=s.substring(o+2);t[p]=i}}return t},encodeArguments=function(e,t){var r=[];for(var n in e)if("object"!=typeof e||e.hasOwnProperty(n)){var s=e[n],o=t?t+"["+n+"]":n;"$$hashKey"!=o&&"$$hashKey"!=n&&(void 0!==s&&null!==s?r.push("object"==typeof s?encodeArguments(s,o,s instanceof Array):o+"="+encodeURIComponent(s)):o&&o.length>0&&"$"==o[0]&&r.push(o))}return r.join("&")},getHeaders=function(e){return"getAllResponseHeaders"in e?parseResponseHeaders(e.getAllResponseHeaders()):{}},JsonpContext={callbacks:{},call_offset:0},JsonpHttpRequest=function(){this.url=null,this.offset=0,this.callback=null,this.msTimeout=2e4,this.credentials={username:null,password:null}};JsonpHttpRequest.prototype.open=function(e,t){this.url=t},JsonpHttpRequest.prototype.onload=function(e){this.callback=e},JsonpHttpRequest.prototype.onerror=function(e){this.callback=e},JsonpHttpRequest.prototype.setCredentials=function(e,t){this.credentials.username=e||null,this.credentials.password=t||null},JsonpHttpRequest.prototype.send=function(e){e=e||{};var t=null,r=null,n=Math.floor((new Date).getTime()/1e3-1373133713),s="call_"+ ++JsonpContext.call_offset+"_"+n;e.js_callback=s,this.credentials.username&&(e.app_id=this.credentials.username),this.credentials.password&&(e.token=this.credentials.password);var o=document.createElement("script");o.setAttribute("async",!0),o.setAttribute("src",this.url+(-1==this.url.indexOf("?")?"?":"&")+encodeArguments(e)),o.setAttribute("type","text/javascript"),this.callback&&(JsonpContext.callbacks[s]=this.callback,t=function(){delete window[s],delete JsonpContext.callbacks[s]},r=setTimeout(function(){JsonpContext.callbacks[s]({code:"CONNECTION_ERROR",message:"Request timed out."}),t()},this.msTimeout)),window[s]=function(e){s in JsonpContext.callbacks&&(r&&clearTimeout(r),JsonpContext.callbacks[s](null,{status:200,response:e,headers:{}}),t&&t())},document.getElementsByTagName("head")[0].appendChild(o)},JsonpHttpRequest.prototype.setRequestHeader=function(){};var HttpRequest=function(e){this.jsonp=e.jsonp===!1?!1:!0,this.base_url=e.base_url||null,this.headers=e.headers||{},this.credentials={username:null,password:null}};HttpRequest.prototype.setCredentials=function(e,t){this.credentials.username=e||null,this.credentials.password=t||null},HttpRequest.prototype.create=function(e,t,r,n){var s=this;n=n||function(){};var o=!1,p=this.base_url+t,i=new XMLHttpRequest;if(!("withCredentials"in i))if("undefined"!=typeof XDomainRequest)i=new XDomainRequest;else{if(!this.jsonp)return n({code:"MISSING_HTTP_PROVIDER",message:"Unable to make HTTP requests. No provider supported."});o=!0,i=new JsonpHttpRequest}if(i.setCredentials?i.setCredentials(this.credentials.username,this.credentials.password):this.headers.Authorization="Basic "+Base64.encode((this.credentials.username||"")+":"+(this.credentials.password||"")),i.open(e,p,!0),i){o&&(i.callback=n),i.onload=function(e){var t=getHeaders(e.target);n(null,{status:e.target.status,response:JSON.parse(e.target.responseText),headers:t})},i.onerror=function(){n({code:"CONNECTION_ERROR",message:"Unable to load '"+p+"'."})};for(var a in s.headers)i.setRequestHeader(a,s.headers[a]);try{o||(r=JSON.stringify(r)),i.send(r)}catch(u){n(u)}}};var Transport=function(){};Transport.prototype.call=function(e,t,r,n,s,o){s=s||function(){};var p=e.debug||UserApp.global.debug,i=e.secure||UserApp.global.secure?"https":"http",a=i+"://"+(e.baseAddress||UserApp.global.baseAddress),u="/v"+t+"/"+r;if(o)return n=n||{},n.app_id=e.appId||UserApp.global.appId,n.token=e.token||UserApp.global.token,n.js_callback="ua_"+(new Date).getTime(),void(document.location=a+u+"?"+encodeArguments(n));var c=new HttpRequest({base_url:a,headers:{"Content-Type":"application/json"}});if(c.setCredentials(e.appId||UserApp.global.appId,e.token||UserApp.global.token),p){u+="?$debug&$beautify",console.log("Calling method "+r+" with arguments "+JSON.stringify(n));var l=s;s=function(e,t){e&&console.error("UserApp error: "+e.name+": "+e.message),console.log(t),l&&l(e,t)}}c.create("POST",u,n,function(e,t){var r=null;if(e)return s(e);var n=t.response;if(n.__logs&&(r=n.__logs,delete n.__logs),n instanceof Array&&n.length>0){var o=n[n.length-1];o&&o.__logs&&(r=n.pop().__logs)}if(r&&p){for(var i=0;i<r.length;++i){var a=r[i],u="object"==typeof a.message?JSON.stringify(a.message):a.message;console.log("UserApp "+a.type+": "+u)}r=null}n.error_code?s({name:n.error_code,message:n.message}):s(null,n)})},UserApp.Transport={},UserApp.Transport.Current=new Transport,UserApp.initialize=function(e){return this.setAppId(e.appId),this.setToken(e.token),this.setBaseAddress(e.baseAddress),this.setDebug(e.debug),this.setSecure(e.secure),this},UserApp.setBaseAddress=function(e){return this.global.baseAddress=e||"api.userapp.io",this},UserApp.setAppId=function(e){return this.global.appId=e,this},UserApp.setToken=function(e){return this.global.token=e,this},UserApp.setDebug=function(e){this.global.debug=e||!1},UserApp.setSecure=function(e){this.global.secure=null==e||void 0==e?!0:e},UserApp.User=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.User.search=function(e,t){UserApp.Transport.Current.call(this,1,"user.search",e,t)},UserApp.User.prototype.search=function(e,t){UserApp.User.search.call(this,e,t)},UserApp.User.save=function(e,t){UserApp.Transport.Current.call(this,1,"user.save",e,t)},UserApp.User.prototype.save=function(e,t){UserApp.User.save.call(this,e,t)},UserApp.User.get=function(e,t){UserApp.Transport.Current.call(this,1,"user.get",e,t)},UserApp.User.prototype.get=function(e,t){UserApp.User.get.call(this,e,t)},UserApp.User.count=function(e,t){"function"==typeof e&&(t=e,e=null),UserApp.Transport.Current.call(this,1,"user.count",e,t)},UserApp.User.prototype.count=function(e,t){UserApp.User.count.call(this,e,t)},UserApp.User.remove=function(e,t){UserApp.Transport.Current.call(this,1,"user.remove",e,t)},UserApp.User.prototype.remove=function(e,t){UserApp.User.remove.call(this,e,t)},UserApp.User.resetPassword=function(e,t){UserApp.Transport.Current.call(this,1,"user.resetPassword",e,t)},UserApp.User.prototype.resetPassword=function(e,t){UserApp.User.resetPassword.call(this,e,t)},UserApp.User.changePassword=function(e,t){UserApp.Transport.Current.call(this,1,"user.changePassword",e,t)},UserApp.User.prototype.changePassword=function(e,t){UserApp.User.changePassword.call(this,e,t)},UserApp.User.verifyEmail=function(e,t){UserApp.Transport.Current.call(this,1,"user.verifyEmail",e,t)},UserApp.User.prototype.verifyEmail=function(e,t){UserApp.User.verifyEmail.call(this,e,t)},UserApp.User.requestEmailVerification=function(e,t){UserApp.Transport.Current.call(this,1,"user.requestEmailVerification",e,t)},UserApp.User.prototype.requestEmailVerification=function(e,t){UserApp.User.requestEmailVerification.call(this,e,t)},UserApp.User.setPlan=function(e,t){UserApp.Transport.Current.call(this,1,"user.setPlan",e,t)},UserApp.User.prototype.setPlan=function(e,t){UserApp.User.setPlan.call(this,e,t)},UserApp.User.getSubscriptionDetails=function(e,t){UserApp.Transport.Current.call(this,1,"user.getSubscriptionDetails",e,t)},UserApp.User.prototype.getSubscriptionDetails=function(e,t){UserApp.User.getSubscriptionDetails.call(this,e,t)},UserApp.User.lock=function(e,t){UserApp.Transport.Current.call(this,1,"user.lock",e,t)},UserApp.User.prototype.lock=function(e,t){UserApp.User.setLock.call(this,e,t)},UserApp.User.unlock=function(e,t){UserApp.Transport.Current.call(this,1,"user.unlock",e,t)},UserApp.User.prototype.unlock=function(e,t){UserApp.User.unlock.call(this,e,t)},UserApp.User.hasPermission=function(e,t){UserApp.Transport.Current.call(this,1,"user.hasPermission",e,t)},UserApp.User.prototype.hasPermission=function(e,t){UserApp.User.hasPermission.call(this,e,t)},UserApp.User.hasFeature=function(e,t){UserApp.Transport.Current.call(this,1,"user.hasFeature",e,t)},UserApp.User.prototype.hasFeature=function(e,t){UserApp.User.hasFeature.call(this,e,t)},UserApp.User.login=function(e,t){var r=this;UserApp.Transport.Current.call(this,1,"user.login",e,function(e,n){if(!e){var s=n.token;"object"==typeof r?r.token=s:UserApp.setToken(s)}t&&t(e,n)})},UserApp.User.prototype.login=function(e,t){UserApp.User.login.call(this,e,t)},UserApp.User.logout=function(e){UserApp.Transport.Current.call(this,1,"user.logout",null,function(t,r){UserApp.setToken(null),e&&e(t,r)})},UserApp.User.prototype.logout=function(e){UserApp.User.logout.call(this,e)},UserApp.Token=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Token.get=function(e,t){UserApp.Transport.Current.call(this,1,"token.get",e,t)},UserApp.Token.prototype.get=function(e,t){UserApp.Token.get.call(this,e,t)},UserApp.Token.search=function(e,t){UserApp.Transport.Current.call(this,1,"token.search",e,t)},UserApp.Token.prototype.search=function(e,t){UserApp.Token.search.call(this,e,t)},UserApp.Token.save=function(e,t){UserApp.Transport.Current.call(this,1,"token.save",e,t)},UserApp.Token.prototype.save=function(e,t){UserApp.Token.save.call(this,e,t)},UserApp.Token.remove=function(e,t){UserApp.Transport.Current.call(this,1,"token.remove",e,t)},UserApp.Token.prototype.remove=function(e,t){UserApp.Token.remove.call(this,e,t)},UserApp.Token.heartbeat=function(e){UserApp.Transport.Current.call(this,1,"token.heartbeat",null,e)},UserApp.Token.prototype.heartbeat=function(e){UserApp.Token.heartbeat.call(this,e)},UserApp.Permission=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Permission.get=function(e,t){UserApp.Transport.Current.call(this,1,"permission.get",e,t)},UserApp.Permission.prototype.get=function(e,t){UserApp.Permission.get.call(this,e,t)},UserApp.Permission.search=function(e,t){UserApp.Transport.Current.call(this,1,"permission.search",e,t)},UserApp.Permission.prototype.search=function(e,t){UserApp.Permission.search.call(this,e,t)},UserApp.Permission.save=function(e,t){UserApp.Transport.Current.call(this,1,"permission.save",e,t)},UserApp.Permission.prototype.save=function(e,t){UserApp.Permission.save.call(this,e,t)},UserApp.Permission.count=function(e){UserApp.Transport.Current.call(this,1,"permission.count",null,e)},UserApp.Permission.prototype.count=function(e){UserApp.Permission.count.call(this,e)},UserApp.Permission.remove=function(e,t){UserApp.Transport.Current.call(this,1,"permission.remove",e,t)},UserApp.Permission.prototype.remove=function(e,t){UserApp.Permission.remove.call(this,e,t)},UserApp.Feature=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Feature.get=function(e,t){UserApp.Transport.Current.call(this,1,"feature.get",e,t)},UserApp.Feature.prototype.get=function(e,t){UserApp.Feature.get.call(this,e,t)},UserApp.Feature.search=function(e,t){UserApp.Transport.Current.call(this,1,"feature.search",e,t)},UserApp.Feature.prototype.search=function(e,t){UserApp.Feature.search.call(this,e,t)},UserApp.Feature.save=function(e,t){UserApp.Transport.Current.call(this,1,"feature.save",e,t)},UserApp.Feature.prototype.save=function(e,t){UserApp.Feature.save.call(this,e,t)},UserApp.Feature.count=function(e){UserApp.Transport.Current.call(this,1,"feature.count",null,e)},UserApp.Feature.prototype.count=function(e){UserApp.Feature.count.call(this,e)},UserApp.Feature.remove=function(e,t){UserApp.Transport.Current.call(this,1,"feature.remove",e,t)},UserApp.Feature.prototype.remove=function(e){UserApp.Feature.remove.call(this,arguments,e)},UserApp.Property=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Property.get=function(e,t){UserApp.Transport.Current.call(this,1,"property.get",e,t)},UserApp.Property.prototype.get=function(e,t){UserApp.Property.get.call(this,e,t)},UserApp.Property.search=function(e,t){UserApp.Transport.Current.call(this,1,"property.search",e,t)},UserApp.Property.prototype.search=function(e,t){UserApp.Property.search.call(this,e,t)},UserApp.Property.save=function(e,t){UserApp.Transport.Current.call(this,1,"property.save",e,t)},UserApp.Property.prototype.save=function(e,t){UserApp.Property.save.call(this,e,t)},UserApp.Property.count=function(e){UserApp.Transport.Current.call(this,1,"property.count",null,e)},UserApp.Property.prototype.count=function(e){UserApp.Property.count.call(this,arguments,e)},UserApp.Property.remove=function(e,t){UserApp.Transport.Current.call(this,1,"property.remove",e,t)},UserApp.Property.prototype.remove=function(e,t){UserApp.Property.remove.call(this,e,t)},UserApp.PriceList=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.PriceList.get=function(e,t){UserApp.Transport.Current.call(this,1,"priceList.get",e,t)},UserApp.PriceList.prototype.get=function(e,t){UserApp.PriceList.get.call(this,e,t)},UserApp.PriceList.search=function(e,t){UserApp.Transport.Current.call(this,1,"priceList.search",e,t)},UserApp.PriceList.prototype.search=function(e,t){UserApp.PriceList.search.call(this,e,t)},UserApp.PriceList.save=function(e,t){UserApp.Transport.Current.call(this,1,"priceList.save",e,t)},UserApp.PriceList.prototype.save=function(e,t){UserApp.PriceList.save.call(this,e,t)},UserApp.PriceList.count=function(e){UserApp.Transport.Current.call(this,1,"priceList.count",null,e)},UserApp.PriceList.prototype.count=function(e){UserApp.PriceList.count.call(this,e)},UserApp.PriceList.remove=function(e,t){UserApp.Transport.Current.call(this,1,"priceList.remove",e,t)},UserApp.PriceList.prototype.remove=function(e,t){UserApp.PriceList.remove.call(this,e,t)},UserApp.Invoice=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Invoice.get=function(e,t){UserApp.Transport.Current.call(this,1,"invoice.get",e,t)},UserApp.Invoice.prototype.get=function(e,t){UserApp.Invoice.get.call(this,e,t)},UserApp.Invoice.search=function(e,t){UserApp.Transport.Current.call(this,1,"invoice.search",e,t)},UserApp.Invoice.prototype.search=function(e,t){UserApp.Invoice.search.call(this,e,t)},UserApp.Invoice.save=function(e,t){UserApp.Transport.Current.call(this,1,"invoice.save",e,t)},UserApp.Invoice.prototype.save=function(e,t){UserApp.Invoice.save.call(this,e,t)},UserApp.Invoice.remove=function(e,t){UserApp.Transport.Current.call(this,1,"invoice.remove",e,t)},UserApp.Invoice.prototype.remove=function(e,t){UserApp.Invoice.remove.call(this,e,t)},UserApp.Charge=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Charge.get=function(e,t){UserApp.Transport.Current.call(this,1,"charge.get",e,t)},UserApp.Charge.prototype.get=function(e,t){UserApp.Charge.get.call(this,e,t)},UserApp.Charge.search=function(e,t){UserApp.Transport.Current.call(this,1,"charge.search",e,t)},UserApp.Charge.prototype.search=function(e,t){UserApp.Charge.search.call(this,e,t)},UserApp.Charge.save=function(e,t){UserApp.Transport.Current.call(this,1,"charge.save",e,t)},UserApp.Charge.prototype.save=function(e,t){UserApp.Charge.save.call(this,e,t)},UserApp.Charge.remove=function(e,t){UserApp.Transport.Current.call(this,1,"charge.remove",e,t)},UserApp.Charge.prototype.remove=function(e,t){UserApp.Charge.remove.call(this,e,t)},UserApp.Plan=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Plan.get=function(e,t){UserApp.Transport.Current.call(this,1,"plan.get",e,t)},UserApp.Plan.prototype.get=function(e,t){UserApp.Plan.get.call(this,e,t)},UserApp.Plan.search=function(e,t){UserApp.Transport.Current.call(this,1,"plan.search",e,t)},UserApp.Plan.prototype.search=function(e,t){UserApp.Plan.search.call(this,e,t)},UserApp.Plan.save=function(e,t){UserApp.Transport.Current.call(this,1,"plan.save",e,t)},UserApp.Plan.prototype.save=function(e,t){UserApp.Plan.save.call(this,e,t)},UserApp.Plan.count=function(e){UserApp.Transport.Current.call(this,1,"plan.count",null,e)},UserApp.Plan.prototype.count=function(e){UserApp.Plan.count.call(this,arguments,e)},UserApp.Plan.remove=function(e,t){UserApp.Transport.Current.call(this,1,"plan.remove",e,t)},UserApp.Plan.prototype.remove=function(e,t){UserApp.Plan.remove.call(this,e,t)},UserApp.User.PaymentMethod=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.User.PaymentMethod.get=function(e,t){UserApp.Transport.Current.call(this,1,"user.paymentMethod.get",e,t)},UserApp.User.PaymentMethod.prototype.get=function(e,t){UserApp.Plan.get.call(this,e,t)},UserApp.User.PaymentMethod.search=function(e,t){UserApp.Transport.Current.call(this,1,"user.paymentMethod.search",e,t)},UserApp.User.PaymentMethod.prototype.search=function(e,t){UserApp.Plan.search.call(this,e,t)},UserApp.User.PaymentMethod.save=function(e,t){UserApp.Transport.Current.call(this,1,"user.paymentMethod.save",e,t)},UserApp.User.PaymentMethod.prototype.save=function(e,t){UserApp.Plan.save.call(this,e,t)},UserApp.User.PaymentMethod.remove=function(e,t){UserApp.Transport.Current.call(this,1,"user.paymentMethod.remove",e,t)},UserApp.User.PaymentMethod.prototype.remove=function(e,t){UserApp.Plan.remove.call(this,e,t)},UserApp.Export=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Export.stream=function(e,t){UserApp.Transport.Current.call(this,1,"export.stream",e,t,!0)},UserApp.Export.prototype.stream=function(e,t){UserApp.Export.stream.call(this,e,t)},UserApp.OAuth=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.OAuth.getAuthorizationUrl=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.getAuthorizationUrl",e,t)},UserApp.OAuth.prototype.getAuthorizationUrl=function(e,t){UserApp.OAuth.getAuthorizationUrl.call(this,e,t)},UserApp.OAuth.consume=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.consume",e,t)},UserApp.OAuth.prototype.consume=function(e,t){UserApp.OAuth.consume.call(this,e,t)},UserApp.OAuth.request=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.request",e,t)},UserApp.OAuth.prototype.request=function(e,t){UserApp.OAuth.request.call(this,e,t)},UserApp.OAuth.Connection=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.OAuth.Connection.search=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.connection.search",e,t)},UserApp.OAuth.Connection.prototype.search=function(e,t){UserApp.OAuth.Connection.search.call(this,e,t)},UserApp.OAuth.Connection.get=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.connection.get",e,t)},UserApp.OAuth.Connection.prototype.get=function(e,t){UserApp.OAuth.Connection.get.call(this,e,t)},UserApp.OAuth.Connection.remove=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.connection.remove",e,t)},UserApp.OAuth.Connection.prototype.remove=function(e,t){UserApp.OAuth.Connection.remove.call(this,e,t)},UserApp.OAuth.Provider=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.OAuth.Provider.get=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.provider.get",e,t)},UserApp.OAuth.Provider.prototype.get=function(e,t){UserApp.OAuth.Provider.get.call(this,e,t)},UserApp.OAuth.Provider.search=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.provider.search",e,t)},UserApp.OAuth.Provider.prototype.search=function(e,t){UserApp.OAuth.Provider.search.call(this,e,t)},UserApp.OAuth.Provider.save=function(e,t){UserApp.Transport.Current.call(this,1,"oauth.provider.save",e,t)},UserApp.OAuth.Provider.prototype.save=function(e,t){UserApp.OAuth.Provider.save.call(this,e,t)},UserApp.Stat=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Stat.Apicall=function(e){e=e||{},e.appId&&(this.appId=e.appId),e.token&&(this.token=e.token)},UserApp.Stat.Apicall.search=function(e,t){UserApp.Transport.Current.call(this,1,"stat.apicall.search",e,t)},UserApp.Stat.Apicall.prototype.search=function(e,t){UserApp.Stat.Apicall.search.call(this,e,t)};var userappModule=angular.module("UserApp",[]);!function(){userappModule.value("UserApp",UserApp),UserApp.tokenStorage||(UserApp.tokenStorage={get:function(){return Cookies.get("ua_session_token")},set:function(e){Cookies.set("ua_session_token",e,{expires:new Date((new Date).getTime()+31536e6)})},remove:function(){Cookies.expire("ua_session_token")}});var e=function(e,t,r){t&&(t.handled=!1,r&&(t.handled=!0,angular.element(document.getElementById(r)).text(t.message)),e.$emit("user.error",t))},t=function(e){return e&&(1==e.public||1==e.login||1==e.verify_email||1==e.set_password)};userappModule.factory("user",["$rootScope","$location","$injector","$log","$timeout","$q",function(e,r,n,s,o,p){var i={},a=null,u=null,c=UserApp.tokenStorage.get(),l={authorized:!1,authenticated:!1},h=-1,f=null,d=null,A={};if(n.has)var U=n.has("$route")?n.get("$route"):null,g=n.has("$state")?n.get("$state"):null;else var U=n.get("$route"),g=null;if(!g||g.transitionTo&&g.get||(g=null),g||U||s.warn("The UserApp module needs either ng-route or ui-router to work as expected."),g)for(var v=g.get(),m=0;m<v.length;++m)A[v[m].name]=v[m];var k=function(e,t){g?t?r.path(A[e].url):g.transitionTo(e):U&&r.path(e)},y=function(e,t,r){e.loading=!0;var n=t.search().email_token;T.verifyEmail(n,function(t){r(t?function(){e.error=t}:function(){e.loading=!1})})},C=function(e,r){if(e){if((!e.data||e.data&&0==t(e.data))&&0==l.authenticated)return T.authenticationRequiredHandler(e,r),!1;if(e.data&&e.data.hasPermission&&i.permissions){if(!T.hasPermission(e.data.hasPermission))return T.accessDeniedHandler(i,e,r),!1}else if(e.data&&e.data.authCheck&&i.user_id&&!e.data.authCheck(i,r))return T.accessDeniedHandler(i,e,r),!1}return!0},P=function(e){if(e.$$route){if(0==t(e.$$route)&&0==l.authenticated)return T.authenticationRequiredHandler(e),!1;if(e.$$route.hasPermission&&i.permissions&&!T.hasPermission(e.$$route.hasPermission))return T.accessDeniedHandler(i,e),!1;if(e.$$route.authCheck&&l.authenticated&&!e.$$route.authCheck(i))return T.accessDeniedHandler(i,e),!1}return!0};e.user=i,e.user.authorized=!1,e.user.authenticated=!1;var T={authenticationRequiredHandler:function(){o(function(){k(d)})},accessDeniedHandler:function(){o(function(){k(f,!0)})},authenticationSuccessHandler:function(){o(function(){k(f,!0)})},onAuthenticationRequired:function(e){this.authenticationRequiredHandler=e},onAuthenticationSuccess:function(e){this.authenticationSuccessHandler=e},onAccessDenied:function(e){this.accessDeniedHandler=e},init:function(n){var s=this,o={auth:function(e,r){if(g)var n=A[this.self.name];if(0==t(U?U.current.$$route:n)){var s=e.defer();try{r.getCurrent().then(function(){(U?P(U.current):C(n))?s.resolve():s.reject()},function(){s.reject()})}catch(o){s.reject(o)}return s.promise}return!0}};if(u=n,g){f="";for(var p in A)A[p].resolve=A[p].resolve||{},angular.extend(A[p].resolve,o),A[p].data&&A[p].data.login&&(d=p)}else if(U){f=(U.routes.null||{redirectTo:""}).redirectTo;for(var i in U.routes)U.routes[i].resolve=U.routes[i].resolve||{},angular.extend(U.routes[i].resolve,o),U.routes[i].login&&(d=U.routes[i].originalPath)}UserApp.initialize({}),this.appId(n.appId);var a;!c&&(a=r.search().ua_token)?this.activate(a,function(){UserApp.setupPersistentToken&&UserApp.setupPersistentToken(function(e,t){t&&s.token(t.value)})}):c&&this.activate(c),g?e.$on("$stateChangeStart",function(e,t,r){return t.data&&1==t.data.verify_email?(t.controller=y,void(t.views&&t.views[""]&&(t.views[""].controller=y))):void(C(t,r)||e.preventDefault())}):U&&e.$on("$routeChangeStart",function(e,t){return t.$$route&&1==t.$$route.verify_email?void(t.$$route.controller=y):void(P(t)||e.preventDefault())})},current:i,status:function(){return l},reset:function(){clearInterval(h),UserApp.setToken(null),c=null,l.authorized=!1,l.authenticated=!1,UserApp.tokenStorage.remove();for(var e in i)delete i[e];g?C(g.current,g.params):U&&P(U.current)},appId:function(e){return e&&(a=e,UserApp.setAppId(a)),a},token:function(t){return t&&(c=t,UserApp.setToken(c),l.authorized=!0,l.authenticated=!0,e.user.authorized=!0,e.user.authenticated=!0,UserApp.tokenStorage.set(c)),c},activate:function(t,r){var n=this;this.token(t),this.startHeartbeat(u.heartbeatInterval),this.loadUser(function(t,s){t?n.reset():(r&&r(t,s),g?C(g.current,g.params):U&&P(U.current),e.$broadcast("user.login"))})},signup:function(e,t){var r=this;return this.reset(),e.password?void UserApp.User.save(e,function(n,s){if(!n){if(s.locks&&s.locks.length>0&&"EMAIL_NOT_VERIFIED"==s.locks[0].type)return void(t&&t({name:"EMAIL_NOT_VERIFIED"},s));r.login(e)}t&&t(n,s)}):void(t&&t({name:"MISSING_PASSWORD",message:"Please enter a password."},null))},verifyEmail:function(e,t){e?UserApp.User.verifyEmail({email_token:e},function(e,r){t&&t(e,r)}):t&&t({name:"INVALID_ARGUMENT_EMAIL_TOKEN",message:"Missing email verification token."},null)},login:function(e,t){var r=this;this.reset(),UserApp.User.login(e,function(e,n){n?n.locks&&n.locks.indexOf("EMAIL_NOT_VERIFIED")>-1?(UserApp.setToken(null),t&&t({name:"EMAIL_NOT_VERIFIED",message:"Please verify your email address by clicking on the link in the verification email that we've sent you."},n)):n.locks&&n.locks.length>0?(UserApp.setToken(null),t&&t({name:"LOCKED",message:"Your account has been locked."},n)):r.activate(n.token,function(){UserApp.setupPersistentToken?UserApp.setupPersistentToken(function(e,s){s&&r.token(s.value),t&&t(e,n)}):t&&t(e,n),r.authenticationSuccessHandler()}):t&&t(e,n)})},logout:function(t){var r=this;UserApp.removePersistentToken?UserApp.removePersistentToken(function(n){r.reset(),e.$broadcast("user.logout"),t&&t(n)}):UserApp.User.logout(function(n){r.reset(),e.$broadcast("user.logout"),t&&t(n)})},resetPassword:function(e,t){this.reset(),UserApp.User.resetPassword(e,function(e,r){t&&t(e,r)})},setPassword:function(e,t,r){this.reset(),UserApp.User.changePassword({password_token:e,new_password:t},function(e,t){r&&r(e,t)})},hasPermission:function(e){if(!this.current||!this.current.permissions||!e)return!1;"object"!=typeof e&&(e=[e]);for(var t=0;t<e.length;++t)if(!this.current.permissions[e[t]]||this.current.permissions[e[t]].value!==!0)return!1;return!0},hasFeature:function(e){if(!this.current||!this.current.features||!e)return!1;"object"!=typeof e&&(e=[e]);for(var t=0;t<e.length;++t)if(!this.current.features[e[t]]||this.current.features[e[t]].value!==!0)return!1;return!0},loadUser:function(e){UserApp.User.get({user_id:"self"},function(t,r){t?e&&e(t,r):o(function(){angular.extend(i,r[0]),e&&e(t,r)})})},getCurrent:function(){var t=p.defer(),r=this;try{if(this.current.user_id)t.resolve(this.current);else var n=e.$on("user.login",function(){t.resolve(r.current),n()})}catch(s){t.reject(s)}return t.promise},startHeartbeat:function(t){var r=this;void 0!=t&&1e4>t||(clearInterval(h),h=setInterval(function(){UserApp.Token.heartbeat(function(t,n){t?(r.reset(),e.$broadcast("user.logout")):(l.authorized=n.alive,l.authenticated=n.alive)})},t||2e4))}};return angular.extend(i,{hasPermission:function(e){return T.hasPermission(e)},hasFeature:function(e){return T.hasFeature(e)}}),T}]),userappModule.directive("uaLogout",["$timeout","user",function(e,t){return{restrict:"A",link:function(r,n){var s=function(n){return n.preventDefault(),r.loading?!1:(e(function(){r.loading=!0}),t.logout(function(){e(function(){r.loading=!1})}),!1)};n.on?n.on("click",s):n.bind("click",s)}}}]),userappModule.directive("uaLogin",["$rootScope","$timeout","user",function(t,r,n){return{restrict:"A",link:function(t,s,o){var p=function(s){return s.preventDefault(),t.loading?!1:(r(function(){t.error=null,t.loading=!0}),n.login({login:this.login.value,password:this.password.value},function(n){return n?(r(function(){t.error=n,t.loading=!1}),e(t,n,o.uaError)):void r(function(){t.loading=!1})}),!1)};s.on?s.on("submit",p):s.bind("submit",p)}}}]),userappModule.directive("uaSignup",["$rootScope","$timeout","user","UserApp",function(t,r,n){return{restrict:"A",link:function(t,s,o){var p=function(s){if(s.preventDefault(),t.loading)return!1;r(function(){t.error=null,t.verificationEmailSent=!1,t.loading=!0});for(var p={},i=0;i<this.elements.length;++i)if(this.elements[i].name){var a=this.elements[i].name.split(".");a.length>1?(p[a[0]]=p[a[0]]||{},p[a[0]][a[1]]=this.elements[i].value):p[this.elements[i].name]=this.elements[i].value,void 0!=angular.element(this.elements[i]).attr("ua-is-email")&&(p.email=this.elements[i].value)}return n.signup(p,function(n){if(n&&n){if("EMAIL_NOT_VERIFIED"!=n.name)return r(function(){t.error=n,t.loading=!1}),e(t,n,o.uaError);r(function(){t.verificationEmailSent=!0,t.loading=!1})}}),!1};s.on?s.on("submit",p):s.bind("submit",p)}}}]),userappModule.directive("uaResetPassword",["$rootScope","$timeout","user",function(t,r,n){return{restrict:"A",link:function(t,s,o){var p=function(s){return s.preventDefault(),t.loading?!1:(r(function(){t.error=null,t.loading=!0}),n.resetPassword({login:this.login.value},function(n){return n?(r(function(){t.error=n,t.loading=!1}),e(t,n,o.uaError)):void r(function(){t.emailSent=!0,t.loading=!1})}),!1)};s.on?s.on("submit",p):s.bind("submit",p)}}}]),userappModule.directive("uaSetPassword",["$rootScope","$location","$timeout","user",function(t,r,n,s){return{restrict:"A",link:function(t,o,p){var i=function(o){return o.preventDefault(),t.loading?!1:(n(function(){t.error=null,t.loading=!0}),s.setPassword(r.search().password_token,this.new_password.value,function(r){return r?(n(function(){t.error=r,t.loading=!1}),e(t,r,p.uaError)):void n(function(){t.passwordSaved=!0,t.loading=!1
})}),!1)};o.on?o.on("submit",i):o.bind("submit",i)}}}]),userappModule.directive("uaOauthLink",["$timeout","$location","user","UserApp",function(t,r,n,s){return{restrict:"A",link:function(o,p,i){var a=function(p){function a(){var e=r.absUrl().replace(window.location.protocol+"//"+window.location.host+window.location.pathname,"");return e.replace(r.path(),"")}if(p.preventDefault(),o.loading)return!1;t(function(){o.error=null,o.loading=!0});var u=i.uaOauthLink,c="uaOauthScopes"in i?(i.uaOauthScopes||"").split(","):null,l=window.location.protocol+"//"+window.location.host+window.location.pathname+a()+"/oauth/callback/",h="uaOauthRedirectUri"in i?i.uaOauthRedirectUri:l;return window.device&&"iOS"==window.device.platform&&0==h.indexOf("file://")&&(h="https://oauth.userapp.io/"),s.OAuth.getAuthorizationUrl({provider_id:u,redirect_uri:h,scopes:c},function(r,p){return r?(t(function(){o.error=r,o.loading=!1}),e(o,r,i.uaError)):void(s.oauthHandler?s.oauthHandler(p.authorization_url,function(e){e?n.activate(e,function(){n.authenticationSuccessHandler()}):t(function(){o.loading=!1})}):window.location.href=p.authorization_url)}),!1};p.on?p.on("click",a):p.bind("click",a)}}}]),userappModule.directive("uaHasPermission",["user",function(e){return{restrict:"A",link:function(t,r,n){var s=r.css("display");r.css("display","none"),t.user=e.current;var o=n.uaHasPermission.split(" ");o&&t.$watch("user",function(){e.hasPermission(o)?r.css("display",s):r.css("display","none")},!0)}}}]),userappModule.directive("uaHasFeature",["user",function(e){return{restrict:"A",link:function(t,r,n){var s=r.css("display");r.css("display","none"),t.user=e.current;var o=n.uaHasFeature.split(" ");o&&t.$watch("user",function(){e.hasFeature(o)?r.css("display",s):r.css("display","none")},!0)}}}]),function(e){"use strict";var t=function(e,r,n){return 1===arguments.length?t.get(e):t.set(e,r,n)};t._document=document,t._navigator=navigator,t.defaults={path:"/"},t.get=function(e){return t._cachedDocumentCookie!==t._document.cookie&&t._renewCache(),t._cache[e]},t.set=function(r,n,s){return s=t._getExtendedOptions(s),s.expires=t._getExpiresDate(n===e?-1:s.expires),t._document.cookie=t._generateCookieString(r,n,s),t},t.expire=function(r,n){return t.set(r,e,n)},t._getExtendedOptions=function(r){return{path:r&&r.path||t.defaults.path,domain:r&&r.domain||t.defaults.domain,expires:r&&r.expires||t.defaults.expires,secure:r&&r.secure!==e?r.secure:t.defaults.secure}},t._isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t._getExpiresDate=function(e,r){switch(r=r||new Date,typeof e){case"number":e=new Date(r.getTime()+1e3*e);break;case"string":e=new Date(e)}if(e&&!t._isValidDate(e))throw Error("`expires` parameter cannot be converted to a valid Date instance");return e},t._generateCookieString=function(e,t,r){return e=encodeURIComponent(e),t=(t+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),r=r||{},e=e+"="+t+(r.path?";path="+r.path:""),e+=r.domain?";domain="+r.domain:"",e+=r.expires?";expires="+r.expires.toUTCString():"",e+=r.secure?";secure":""},t._getCookieObjectFromString=function(r){var n={};r=r?r.split("; "):[];for(var s=0;s<r.length;s++){var o=t._getKeyValuePairFromCookieString(r[s]);n[o.key]===e&&(n[o.key]=o.value)}return n},t._getKeyValuePairFromCookieString=function(e){var t=e.indexOf("="),t=0>t?e.length:t;return{key:decodeURIComponent(e.substr(0,t)),value:decodeURIComponent(e.substr(t+1))}},t._renewCache=function(){t._cache=t._getCookieObjectFromString(t._document.cookie),t._cachedDocumentCookie=t._document.cookie},t._areEnabled=function(){var e="1"===t.set("cookies.js",1).get("cookies.js");return t.expire("cookies.js"),e},t.enabled=t._areEnabled(),"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.Cookies=t):window.Cookies=t}()}();